"use strict";!function(){function a(a,b){return(b.getTime()-a.getTime())/c}var b=angular.module("angularBasicAuth",["LocalStorageModule","base64"]),c=6e4;b.constant("MODULE_VERSION","0.0.0"),b.value("authDefaults",{authenticateUrl:"/api/authenticate",sessionMinutes:180}),b.factory("authInterceptor",["$q","authService",function(a,b){var c={request:function(a){var c=b.getAuth();return c&&(a.headers.Authorization=c),a},responseError:function(c){return 401===c.status&&b.handleAuthFailure(),a.reject(c)}};return c}]),function(){b.factory("authService",["$log","localStorageService","$base64","$q","$rootScope","$interval","authDefaults",function(b,c,d,e,f,g,h){function i(){b.debug("logout event"),c.remove(p),c.remove(q),c.remove(o),f.$emit("logout")}function j(a,e){b.debug("Setting credentials for user: "+a),c.set(o,a),c.set(p,"Basic "+d.encode(a+":"+e)),k()}function k(){c.set(q,(new Date).toString())}function l(){var b=c.get(q)||"";return""===b?!1:a(new Date(b),new Date)<h.sessionMinutes}function m(){l()||(b.debug("Authentication credentials missing or out of date"),i())}function n(){return c.get(p)}b.debug("authService constructed");var o="username",p="auth",q="last-activity";return m(),g(m,6e4),{getAuth:n,logout:i,activity:k,username:function(){return m(),c.get(o)},handleAuthFailure:function(){i(),f.$emit("authentication-failure")},login:function(a,c){function d(){200!==this.status?g.reject():g.resolve()}b.debug("login event"),j(a,c);var g=e.defer(),k=g.promise,l=new XMLHttpRequest;return l.onload=d,l.open("GET",h.authenticateUrl),l.setRequestHeader("Accept","application/json"),l.setRequestHeader("Authorization",n()),l.send(null),k.success=function(a){return k.then(function(){a()}),k},k.error=function(a){return k.then(null,function(){a()}),k},k.then(function(){b.debug("Successfully authenticated"),f.$emit("login",a)},function(){b.debug("Test authentication failed"),i(),f.$emit("authentication-failed",a)}),k}}}])}(),b.config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}])}();